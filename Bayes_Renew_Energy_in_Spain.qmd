---
title: "Final Project"
format: html
editor: visual
---

## Bayes Renewable Energy Forecasting

[Data on Kaggle](https://www.kaggle.com/datasets/nicholasjhana/energy-consumption-generation-prices-and-weather/data)

**Objective:** Plot the distribution of total energy demand. Can any of the features in the data help us predict demand? Can any of the features in the data help us predict wind or solar energy generation. Can we forecast a renewable energy sources supply and total energy demand to see the gap?

**Guidance:** Join the data, extract features from date (day of week, season, hour, etc..), filter city for Barcelona

## Loading in Libraries

```{r, warning = FALSE, message=FALSE}
# Libraries
library(janitor)
library(here)
library(tidyverse)
library(rstan)
library(bayesrules)
library(bayesplot)
library(broom.mixed)
library(ggpubr)
```

## Reading in Data

```{r}
energy_data <- read_csv("Data/energy_dataset.csv")
weather_features_data <- read_csv("Data/weather_features.csv")
```

## Joining the Data Frames Together

```{r}
names(weather_features_data)[names(weather_features_data) == "dt_iso"] <- "time"
str(weather_features_data)
```

```{r}
energy_weather_data <- merge(energy_data, weather_features_data, by = c("time"))
```

```{r}
# Writing a New CSV File
write.csv(energy_weather_data, "energy_weather_data")
```

## Exploratory Analysis

#### Exploring Combined Dataset

```{r}
energy_weather_data <- read_csv("energy_weather_data")
dim(energy_weather_data)
```

#### Filter for Barcelona

```{r}
barcelona_weather_data <- energy_weather_data %>% 
  filter(city_name == "Barcelona")
```

#### Looking at the `dim` of new `barcelona_weather_data`

```{r}
dim(barcelona_weather_data)
```

#### Count columns that have too much `zeros` or `NAs`

```{r}
df_na <- as.data.frame(colSums(is.na(barcelona_weather_data)))
```

#### Count `zeros`

```{r}
df_zero <- as.data.frame(colSums(barcelona_weather_data==0))
```

#### Combine zero and NA data for better viewing

```{r}
df_zero_na <- cbind(df_na, df_zero)
view(df_zero_na)
```

#### Remove other columns such as city_name and have only zero/NA values

```{r}
Barcelona_1 <- subset(barcelona_weather_data, select = -c(city_name, 
                                                          generation.hydro.pumped.storage.aggregated, 
                                                          forecast.wind.offshore.eday.ahead, rain_1h,
                                                          rain_3h, snow_3h))

```

#### Extract Date Features (Month, Year, Day)

```{r}
str(Barcelona_1$time)
```

```{r}
Barcelona_1$year <- format(Barcelona_1$time, "%Y")
Barcelona_1$month <- format(Barcelona_1$time, "%m")
Barcelona_1$day <- format(Barcelona_1$time, "%d")
Barcelona_1$day_of_the_week <-format(Barcelona_1$time, "%a")
```

##### Seasons in Spain link:  <https://seasonsyear.com/Spain/Barcelona>

```{r}
Barcelona_1$season <- ifelse(Barcelona_1$month>=3 & Barcelona_1$month<=5, "Spring",
                             ifelse(Barcelona_1$month>=6 & Barcelona_1$month<=8, "Summer",
                                    ifelse(Barcelona_1$month>=9 & Barcelona_1$month<=11, "Fall","Winter")))
```

```{r}
view(Barcelona_1)
```

## Bayesian Method

## Answering the Following Questions

## 
